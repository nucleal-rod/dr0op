
    /*!
    * image2D - üçá ‰ΩøÁî®ECMAScriptÁªòÂà∂‰∫åÁª¥ÂõæÁâá„ÄÇDrawing Two-Dimensional Pictures Using ECMAScript.
    * git+https://github.com/yelloxing/image2D.git
    *
    * author ÂøÉÂè∂
    *
    * version 0.0.1-dev
    *
    * build Thu Apr 11 2019
    *
    * Copyright yelloxing
    * Released under the MIT license
    *
    * Date:Mon Apr 22 2019 17:45:45 GMT+0800 (GMT+08:00)
    */

"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";var w=function e(t){return t&&(t.nodeType===1||t.nodeType===9||t.nodeType===11)};var a=function e(t){return t&&t.nodeType===3};var e=function e(t,r){for(var n in r){try{t[n]=r[n]}catch(e){throw new Error("Illegal property valueÔºÅ")}}return t};var u={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var m={whitespace:"[\\x20\\t\\r\\n\\f]",blank:"[\\n\\f\\r]",identifier:"(?:\\\\.|[\\w-]|[^\0-\\xa0])+"};var f=["href","title","show","type","role","actuate"];var d=function e(t,r){if("innerHTML"in SVGElement.prototype===false||"innerHTML"in SVGSVGElement.prototype===false){var n=document.createElement("div");n.innerHTML=r;var o=function e(t){var r=document.createElementNS(u.svg,t.tagName.toLowerCase());var n=t.attributes,i=void 0;for(i=0;n&&i<n.length;i++){if(f.indexOf(n[i].nodeName)>=0){r.setAttributeNS(u.xlink,"xlink:"+n[i].nodeName,t.getAttribute(n[i].nodeName))}else{r.setAttribute(n[i].nodeName,t.getAttribute(n[i].nodeName))}}return r};var i=o(n.firstChild);(function e(t,r){var n=t.firstChild;if(a(n)){r.textContent=t.innerText;return}while(n){var i=o(n);r.appendChild(i);if(n.firstChild)e(n,i);n=n.nextSibling}})(n.firstChild,i);t.appendChild(i)}else{t.innerHTML=r}};var r=function e(t,r){var n=void 0,i=void 0;if(r==="HTML"){n=document.createElement("div");n.innerHTML=t}else{n=document.createElementNS(u.svg,"svg");d(n,t)}i=n.childNodes;for(var o=0;o<i.length;o++){if(w(i[o]))return i[o]}};function g(e){if(new RegExp("^"+m.identifier+"$").test(e))e="<"+e+"></"+e+">";var t=r(e,"SVG");if(!t||/[A-Z]/.test(t.tagName)||t.tagName==="canvas"){t=r(e,"HTML")}return t}function i(e,t){if(typeof e==="string"){e=e.trim().replace(new RegExp(m.blank,"g"),"");if(/^</.test(e)){return[g(e)]}else if(e==="*"){return t.getElementsByTagName("*")}var r=e.match(new RegExp("#"+m.identifier,"g"));if(r){return document.getElementById(r[0].replace("#",""))}var n=e.match(new RegExp("\\."+m.identifier,"g")),i=e.match(new RegExp("^"+m.identifier));if(i||n){var o=document.getElementsByTagName(i?i[0]:"*"),a=[];for(var u=0;u<o.length;u++){var f=" "+o[u].getAttribute("class")+" ",d=true;for(var l=0;n&&l<n.length;l++){if(!f.match(" "+n[l].replace(".","")+" ")){d=false;break}}if(d)a.push(o[u])}return a}else{throw new Error("Unsupported selectorÔºö"+e)}}else if(w(e)){return[e]}else if(e&&(e.constructor===Array||e.constructor===HTMLCollection||e.constructor===NodeList)){var c=[];for(var v=0;v<e.length;v++){if(w(e[v]))c.push(e[v])}return c}else if(e&&e.__constructor__==="image2D"){return e}else if(typeof e==="function"){var s=t.getElementsByTagName("*"),p=[];for(var h=0;h<s.length;h++){if(e(s[h]))p.push(s[h])}return p}else{throw new Error("Unsupported selectorÔºö"+e)}}var t=function e(t,r){return new e.prototype.init(t,r)};t.prototype.init=function(e,t){this.context=t=t||document;var r=i(e,t),n=void 0;for(n=0;n<r.length;n++){this[n]=r[n]}this.selector=e;this.length=r.length;this.__constructor__="image2D";return this};t.prototype.extend=t.extend=function(){var e=arguments[0]||{};var t=arguments[1]||{};var r=arguments.length;if(r===1){t=e;e=this}if((typeof e==="undefined"?"undefined":_typeof(e))!=="object"&&typeof e!=="function"){e={}}for(var n in t){try{e[n]=t[n]}catch(e){throw new Error("Illegal property valueÔºÅ")}}return e};t.prototype.init.prototype=t.prototype;function n(){var f={e:{}},d=void 0,n=void 0,i=function e(){var a=[],u=0,f=0;(function e(t,r){if(r>f)f=r;var n=void 0;for(n=0;n<t.children.length;n++){e(d[t.children[n]],r+1)}d[t.id].left=r+.5;if(n==0){if(a[r]==undefined)a[r]=-.5;if(a[r-1]==undefined)a[r-1]=-.5;d[t.id].top=a[r]+1;var i=a[r]+1+(d[t.pid].children.length-1)*.5;if(i-1<a[r-1])d[t.id].top=a[r-1]+1-(d[t.pid].children.length-1)*.5}else{d[t.id].top=(d[t.children[0]].top+d[t.children[n-1]].top)*.5}if(d[t.id].top<=a[r]){var o=a[r]+1-d[t.id].top;(function e(t,r){d[t].top+=o;if(a[r]<d[t].top)a[r]=d[t].top;var n=void 0;for(n=0;n<d[t].children.length;n++){e(d[t].children[n],r+1)}})(t.id,r)}a[r]=d[t.id].top;if(d[t.id].top+.5>u)u=d[t.id].top+.5})(d[n],0);return{node:d,root:n,size:u,deep:f+1}};var o=function e(o){var a={};var t=f.e.root(o),u=void 0,r=void 0;u=r=f.e.id(t);a[u]={data:t,pid:null,id:u,children:[]};(function e(t,r){var n=f.e.child(t,o),i=void 0;for(i=0;n&&i<n.length;i++){u=f.e.id(n[i]);a[r].children.push(u);a[u]={data:n[i],pid:r,id:u,children:[]};e(n[i],u)}})(t,u);return[r,a]};var t=function e(t){var r=o(t);d=r[1];n=r[0];return i()};t.root=function(e){f.e.root=e;return t};t.child=function(e){f.e.child=e;return t};t.id=function(e){f.e.id=e;return t};return t}function o(e,t,r,n){n=n||0;var i=Math.sqrt(t*t+r*r+n*n);return[1,0,0,0,0,1,0,0,0,0,1,0,t*e/i,r*e/i,n*e/i,1]}function c(e){var t=Math.sin(e),r=Math.cos(e);return[r,t,0,0,-t,r,0,0,0,0,1,0,0,0,0,1]}function v(e,t,r,n,i,o){n=n||0;i=i||0;o=o||0;return[e,0,0,0,0,t,0,0,0,0,r,0,n-n*e,i-i*t,o-o*r,1]}function s(e,t,r,n,i,o){if(typeof e==="number"&&typeof t==="number"){if(typeof r!=="number"){r=0;n=e;i=t;o=1}else if(typeof n!=="number"||typeof i!=="number"||typeof o!=="number"){n=e;i=t;o=r;e=0;t=0;r=0}if(e==n&&t==i&&r==o)throw new Error("It's not a legitimate ray!");var a=Math.sqrt((n-e)*(n-e)+(i-t)*(i-t)),u=a!=0?(i-t)/a:1,f=a!=0?(n-e)/a:0,d=(n-e)*f+(i-t)*u,l=o-r,c=Math.sqrt(d*d+l*l),v=c!=0?l/c:1,s=c!=0?d/c:0;return[[u,v*f,f*s,0,-f,u*v,u*s,0,0,-s,v,0,t*f-e*u,r*s-e*f*v-t*u*v,-e*f*s-t*u*s-r*v,1],[u,-f,0,0,v*f,v*u,-s,0,f*s,u*s,v,0,e,t,r,1]]}else{throw new Error("a1 and b1 is required!")}}var p=function e(t,r){var n=[];for(var i=0;i<4;i++){for(var o=0;o<r.length/4;o++){n[o*4+i]=t[i]*r[o*4]+t[i+4]*r[o*4+1]+t[i+8]*r[o*4+2]+t[i+12]*r[o*4+3]}}return n};function l(e){var d=e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var l={move:function e(t,r,n,i){d=p(o(t,r,n,i),d);return l},rotate:function e(t,r,n,i,o,a,u){var f=s(r,n,i,o,a,u);d=p(p(p(f[1],c(t)),f[0]),d);return l},scale:function e(t,r,n,i,o,a){d=p(v(t,r,n,i,o,a),d);return l},multiply:function e(t,r){d=r?p(d,t):p(t,d);return l},use:function e(t,r,n,i){n=n||0;i=i||1;var o=p(d,[t,r,n,i]);o[0]=+o[0].toFixed(7);o[1]=+o[1].toFixed(7);o[2]=+o[2].toFixed(7);o[3]=+o[3].toFixed(7);return o},value:function e(){return d}};return l}var h=[];var y=13;var x=400;var b=null;function E(t,e,r){var f={timer:function e(t,r,n){if(!t){throw new Error("tick is required!")}r=r||x;var i=(new Date).valueOf()+"_"+(Math.random()*1e3).toFixed(0);h.push({id:i,createTime:new Date,tick:t,duration:r,callback:n});f.start();return i},start:function e(){if(!b){b=window.setInterval(f.tick,y)}},tick:function e(){var t=void 0,r=void 0,e=void 0,n=void 0,i=void 0,o=void 0,a=void 0,u=h;h=[];h.length=0;for(r=0;r<u.length;r++){i=u[r];t=i.createTime;e=i.tick;o=i.duration;n=i.callback;a=(+new Date-t)/o;a=a>1?1:a;e(a);if(a<1&&i.id){h.push(i)}else if(n){n(a)}}if(h.length<=0){f.stop()}},stop:function e(){if(b){window.clearInterval(b);b=null}}};var n=f.timer(function(e){t(e)},e,r);return function(){var e=void 0;for(e in h){if(h[e].id==n){h[e].id=undefined;return}}}}function T(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return typeof t==="string"?r.getPropertyValue(t):r}var N=function e(t){var r=document.getElementsByTagName("head")[0];r.style.color=t;var n=T(r,"color").replace(/^rgba?\(([^)]+)\)$/,"$1").split(new RegExp("\\,"+m.whitespace));return[+n[0],+n[1],+n[2],n[3]==undefined?1:+n[3]]};function M(f){f=e({u:.5},f);var d=void 0,l=void 0,c=void 0;var v=function e(t){if(d){var r=(t-l)/(c-l),n=r*r,i=r*n;var o=i*d[0]+n*d[1]+r*d[2]+d[3];return o*(c-l)}else throw new Error("You shoud first set the position!")};v.setP=function(e,t,r,n,i,o){if(e<r){l=e;c=r;var a=f.u*i,u=f.u*o;t/=r-e;n/=r-e;d=[2*t-2*n+a+u,3*n-3*t-2*a-u,a,t]}else throw new Error("The point position should be increamented!");return v};return v}function S(i){i=e({t:0},i);var o=void 0,r=void 0;var a=function e(t){if(o){r=-1;while(r+1<o.x.length&&(t>o.x[r+1]||r==-1&&t>=o.x[r+1])){r+=1}if(r==-1||r>=o.h.length)throw new Error("Coordinate crossing!");return o.h[r](t)}else{throw new Error("You shoud first set the position!")}};a.setT=function(e){if(typeof e==="number"){i.t=e}else{throw new Error("Expecting a figure!")}return a};a.setP=function(e){o={x:[],h:[]};var t=void 0,r=(e[1][1]-e[0][1])/(e[1][0]-e[0][0]),n=void 0;o.x[0]=e[0][0];for(t=1;t<e.length;t++){if(e[t][0]<=e[t-1][0])throw new Error("The point position should be increamented!");o.x[t]=e[t][0];n=t<e.length-1?(e[t+1][1]-e[t-1][1])/(e[t+1][0]-e[t-1][0]):(e[t][1]-e[t-1][1])/(e[t][0]-e[t-1][0]);o.h[t-1]=M({u:(1-i.t)*.5}).setP(e[t-1][0],e[t-1][1],e[t][0],e[t][1],r,n);r=n}return a};return a}t.treeLayout=n;t.Matrix4=l;t.animation=E;t.formatColor=N;t.cardinal=S;var k=window.image2D,C=window.$$;t.noConflict=function(e){if(window.$$===t){window.$$=C}if(e&&window.image2D===t){window.image2D=k}return t};window.image2D=window.$$=t})();