
    /*!
    * image2D - üçá ‰ΩøÁî®ECMAScriptÁªòÂà∂‰∫åÁª¥ÂõæÁâá„ÄÇDrawing Two-Dimensional Pictures Using ECMAScript.
    * git+https://github.com/yelloxing/image2D.git
    *
    * author ÂøÉÂè∂
    *
    * version 0.0.1-dev
    *
    * build Thu Apr 11 2019
    *
    * Copyright yelloxing
    * Released under the MIT license
    *
    * Date:Tue Apr 23 2019 15:15:48 GMT+0800 (GMT+08:00)
    */

"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){"use strict";var m=function e(t){return t&&(t.nodeType===1||t.nodeType===9||t.nodeType===11)};var a=function e(t){return t&&t.nodeType===3};var e=function e(t,r){for(var n in r){try{t[n]=r[n]}catch(e){throw new Error("Illegal property valueÔºÅ")}}return t};var u={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var y={whitespace:"[\\x20\\t\\r\\n\\f]",blank:"[\\n\\f\\r]",identifier:"(?:\\\\.|[\\w-]|[^\0-\\xa0])+"};var f=["href","title","show","type","role","actuate"];var l=function e(t,r){if("innerHTML"in SVGElement.prototype===false||"innerHTML"in SVGSVGElement.prototype===false){var n=document.createElement("div");n.innerHTML=r;var o=function e(t){var r=document.createElementNS(u.svg,t.tagName.toLowerCase());var n=t.attributes,i=void 0;for(i=0;n&&i<n.length;i++){if(f.indexOf(n[i].nodeName)>=0){r.setAttributeNS(u.xlink,"xlink:"+n[i].nodeName,t.getAttribute(n[i].nodeName))}else{r.setAttribute(n[i].nodeName,t.getAttribute(n[i].nodeName))}}return r};var i=o(n.firstChild);(function e(t,r){var n=t.firstChild;if(a(n)){r.textContent=t.innerText;return}while(n){var i=o(n);r.appendChild(i);if(n.firstChild)e(n,i);n=n.nextSibling}})(n.firstChild,i);t.appendChild(i)}else{t.innerHTML=r}};var r=function e(t,r){var n=void 0,i=void 0;if(r==="HTML"){n=document.createElement("div");n.innerHTML=t}else{n=document.createElementNS(u.svg,"svg");l(n,t)}i=n.childNodes;for(var o=0;o<i.length;o++){if(m(i[o]))return i[o]}};function x(e){if(new RegExp("^"+y.identifier+"$").test(e))e="<"+e+"></"+e+">";var t=r(e,"SVG");if(!t||/[A-Z]/.test(t.tagName)||t.tagName==="canvas"){t=r(e,"HTML")}return t}function o(e,t){if(typeof e==="string"){e=e.trim().replace(new RegExp(y.blank,"g"),"");if(/^</.test(e)){var r=x(e);if(m(r))return[r];else return[]}else if(e==="*"){return t.getElementsByTagName("*")}var n=e.match(new RegExp("#"+y.identifier,"g"));if(n){var i=document.getElementById(n[0].replace("#",""));if(m(i))return[i];else return[]}var o=e.match(new RegExp("\\."+y.identifier,"g")),a=e.match(new RegExp("^"+y.identifier));if(a||o){var u=document.getElementsByTagName(a?a[0]:"*"),f=[];for(var l=0;l<u.length;l++){var d=" "+u[l].getAttribute("class")+" ",c=true;for(var s=0;o&&s<o.length;s++){if(!d.match(" "+o[s].replace(".","")+" ")){c=false;break}}if(c)f.push(u[l])}return f}else{throw new Error("Unsupported selector:"+e)}}else if(m(e)){return[e]}else if(e&&(e.constructor===Array||e.constructor===HTMLCollection||e.constructor===NodeList)){var h=[];for(var v=0;v<e.length;v++){if(m(e[v]))h.push(e[v])}return h}else if(e&&e.__constructor__==="image2D"){return e}else if(typeof e==="function"){var p=t.getElementsByTagName("*"),g=[];for(var w=0;w<p.length;w++){if(e(p[w]))g.push(p[w])}return g}else{throw new Error("Unknown selector:"+e)}}var t=function e(t,r){return new e.prototype.init(t,r)};t.prototype.init=function(e,t){this.context=t=t||document;var r=o(e,t),n=void 0;for(n=0;n<r.length;n++){this[n]=r[n]}this.selector=e;this.length=r.length;this.__constructor__="image2D";return this};t.prototype.extend=t.extend=function(){var e=arguments[0]||{};var t=arguments[1]||{};var r=arguments.length;if(r===1){t=e;e=this}if((typeof e==="undefined"?"undefined":_typeof(e))!=="object"&&typeof e!=="function"){e={}}for(var n in t){try{e[n]=t[n]}catch(e){throw new Error("Illegal property valueÔºÅ")}}return e};t.prototype.init.prototype=t.prototype;function n(){var f={e:{}},l=void 0,n=void 0,i=function e(){var a=[],u=0,f=0;(function e(t,r){if(r>f)f=r;var n=void 0;for(n=0;n<t.children.length;n++){e(l[t.children[n]],r+1)}l[t.id].left=r+.5;if(n==0){if(a[r]==undefined)a[r]=-.5;if(a[r-1]==undefined)a[r-1]=-.5;l[t.id].top=a[r]+1;var i=a[r]+1+(l[t.pid].children.length-1)*.5;if(i-1<a[r-1])l[t.id].top=a[r-1]+1-(l[t.pid].children.length-1)*.5}else{l[t.id].top=(l[t.children[0]].top+l[t.children[n-1]].top)*.5}if(l[t.id].top<=a[r]){var o=a[r]+1-l[t.id].top;(function e(t,r){l[t].top+=o;if(a[r]<l[t].top)a[r]=l[t].top;var n=void 0;for(n=0;n<l[t].children.length;n++){e(l[t].children[n],r+1)}})(t.id,r)}a[r]=l[t.id].top;if(l[t.id].top+.5>u)u=l[t.id].top+.5})(l[n],0);return{node:l,root:n,size:u,deep:f+1}};var o=function e(o){var a={};var t=f.e.root(o),u=void 0,r=void 0;u=r=f.e.id(t);a[u]={data:t,pid:null,id:u,children:[]};(function e(t,r){var n=f.e.child(t,o),i=void 0;for(i=0;n&&i<n.length;i++){u=f.e.id(n[i]);a[r].children.push(u);a[u]={data:n[i],pid:r,id:u,children:[]};e(n[i],u)}})(t,u);return[r,a]};var t=function e(t){var r=o(t);l=r[1];n=r[0];return i()};t.root=function(e){f.e.root=e;return t};t.child=function(e){f.e.child=e;return t};t.id=function(e){f.e.id=e;return t};return t}function c(e,t,r,n){n=n||0;var i=Math.sqrt(t*t+r*r+n*n);return[1,0,0,0,0,1,0,0,0,0,1,0,t*e/i,r*e/i,n*e/i,1]}function s(e){var t=Math.sin(e),r=Math.cos(e);return[r,t,0,0,-t,r,0,0,0,0,1,0,0,0,0,1]}function h(e,t,r,n,i,o){n=n||0;i=i||0;o=o||0;return[e,0,0,0,0,t,0,0,0,0,r,0,n-n*e,i-i*t,o-o*r,1]}function v(e,t,r,n,i,o){if(typeof e==="number"&&typeof t==="number"){if(typeof r!=="number"){r=0;n=e;i=t;o=1}else if(typeof n!=="number"||typeof i!=="number"||typeof o!=="number"){n=e;i=t;o=r;e=0;t=0;r=0}if(e==n&&t==i&&r==o)throw new Error("It's not a legitimate ray!");var a=Math.sqrt((n-e)*(n-e)+(i-t)*(i-t)),u=a!=0?(i-t)/a:1,f=a!=0?(n-e)/a:0,l=(n-e)*f+(i-t)*u,d=o-r,c=Math.sqrt(l*l+d*d),s=c!=0?d/c:1,h=c!=0?l/c:0;return[[u,s*f,f*h,0,-f,u*s,u*h,0,0,-h,s,0,t*f-e*u,r*h-e*f*s-t*u*s,-e*f*h-t*u*h-r*s,1],[u,-f,0,0,s*f,s*u,-h,0,f*h,u*h,s,0,e,t,r,1]]}else{throw new Error("a1 and b1 is required!")}}var p=function e(t,r){var n=[];for(var i=0;i<4;i++){for(var o=0;o<r.length/4;o++){n[o*4+i]=t[i]*r[o*4]+t[i+4]*r[o*4+1]+t[i+8]*r[o*4+2]+t[i+12]*r[o*4+3]}}return n};function i(e){var l=e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var d={move:function e(t,r,n,i){l=p(c(t,r,n,i),l);return d},rotate:function e(t,r,n,i,o,a,u){var f=v(r,n,i,o,a,u);l=p(p(p(f[1],s(t)),f[0]),l);return d},scale:function e(t,r,n,i,o,a){l=p(h(t,r,n,i,o,a),l);return d},multiply:function e(t,r){l=r?p(l,t):p(t,l);return d},use:function e(t,r,n,i){n=n||0;i=i||1;var o=p(l,[t,r,n,i]);o[0]=+o[0].toFixed(7);o[1]=+o[1].toFixed(7);o[2]=+o[2].toFixed(7);o[3]=+o[3].toFixed(7);return o},value:function e(){return l}};return d}var d=[];var g=13;var w=400;var b=null;function E(t,e,r){var f={timer:function e(t,r,n){if(!t){throw new Error("tick is required!")}r=r||w;var i=(new Date).valueOf()+"_"+(Math.random()*1e3).toFixed(0);d.push({id:i,createTime:new Date,tick:t,duration:r,callback:n});f.start();return i},start:function e(){if(!b){b=window.setInterval(f.tick,g)}},tick:function e(){var t=void 0,r=void 0,e=void 0,n=void 0,i=void 0,o=void 0,a=void 0,u=d;d=[];d.length=0;for(r=0;r<u.length;r++){i=u[r];t=i.createTime;e=i.tick;o=i.duration;n=i.callback;a=(+new Date-t)/o;a=a>1?1:a;e(a);if(a<1&&i.id){d.push(i)}else if(n){n(a)}}if(d.length<=0){f.stop()}},stop:function e(){if(b){window.clearInterval(b);b=null}}};var n=f.timer(function(e){t(e)},e,r);return function(){var e=void 0;for(e in d){if(d[e].id==n){d[e].id=undefined;return}}}}function T(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return typeof t==="string"?r.getPropertyValue(t):r}var N=function e(t){var r=document.getElementsByTagName("head")[0];r.style.color=t;var n=T(r,"color").replace(/^rgba?\(([^)]+)\)$/,"$1").split(new RegExp("\\,"+y.whitespace));return[+n[0],+n[1],+n[2],n[3]==undefined?1:+n[3]]};function k(f){f=e({u:.5},f);var l=void 0,d=void 0,c=void 0;var s=function e(t){if(l){var r=(t-d)/(c-d),n=r*r,i=r*n;var o=i*l[0]+n*l[1]+r*l[2]+l[3];return o*(c-d)}else throw new Error("You shoud first set the position!")};s.setP=function(e,t,r,n,i,o){if(e<r){d=e;c=r;var a=f.u*i,u=f.u*o;t/=r-e;n/=r-e;l=[2*t-2*n+a+u,3*n-3*t-2*a-u,a,t]}else throw new Error("The point x-position should be increamented!");return s};return s}function S(i){i=e({t:0},i);var o=void 0,r=void 0;var a=function e(t){if(o){r=-1;while(r+1<o.x.length&&(t>o.x[r+1]||r==-1&&t>=o.x[r+1])){r+=1}if(r==-1||r>=o.h.length)throw new Error("Coordinate crossing!");return o.h[r](t)}else{throw new Error("You shoud first set the position!")}};a.setT=function(e){if(typeof e==="number"){i.t=e}else{throw new Error("Expecting a figure!")}return a};a.setP=function(e){o={x:[],h:[]};var t=void 0,r=(e[1][1]-e[0][1])/(e[1][0]-e[0][0]),n=void 0;o.x[0]=e[0][0];for(t=1;t<e.length;t++){if(e[t][0]<=e[t-1][0])throw new Error("The point position should be increamented!");o.x[t]=e[t][0];n=t<e.length-1?(e[t+1][1]-e[t-1][1])/(e[t+1][0]-e[t-1][0]):(e[t][1]-e[t-1][1])/(e[t][0]-e[t-1][0]);o.h[t-1]=k({u:(1-i.t)*.5}).setP(e[t-1][0],e[t-1][1],e[t][0],e[t][1],r,n);r=n}return a};return a}var M=function e(t,r){var n=o(t,r||document);if(n.length>0){for(var i=0;i<this.length;i++){n[0].appendChild(this[i])}}else{throw new Error("Target empty!")}return this};var C=function e(t,r){var n=o(t,r||document);if(n.length>0){for(var i=0;i<this.length;i++){n[0].insertBefore(this[i],n[0].childNodes[0])}}else{throw new Error("Target empty!")}return this};function _(){if(arguments.length<=1&&(arguments.length<=0||_typeof(arguments[0])!=="object")){if(this.length<=0)throw new Error("Target empty!");return T(this[0],arguments[0])}for(var e=0;e<this.length;e++){if(arguments.length===1){for(var t in arguments[0]){this[e].style[t]=arguments[0][t]}}else this[e].style[arguments[0]]=arguments[1]}return this}var L=function e(t,r,n){if(/[a-z]/.test(t.tagName)&&f.indexOf(r)>=0){t.setAttributeNS(u.xlink,"xlink:"+r,n)}else t.setAttribute(r,n)};function $(){if(arguments.length===1&&_typeof(arguments[0])!=="object"){if(this.length<=0)throw new Error("Target empty!");return this[0].getAttribute(arguments[0])}else if(arguments.length>0){for(var e=0;e<this.length;e++){if(arguments.length===1){for(var t in arguments[0]){L(this[e],t,arguments[0][t])}}else L(this[e],arguments[0],arguments[1])}}return this}t.extend({treeLayout:n,Matrix4:i,animation:E,formatColor:N,cardinal:S});t.prototype.extend({appendTo:M,prependTo:C,css:_,attr:$});var A=window.image2D,D=window.$$;t.noConflict=function(e){if(window.$$===t){window.$$=D}if(e&&window.image2D===t){window.image2D=A}return t};window.image2D=window.$$=t})();